pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build') {
            steps {
                sh 'npm install'
            }
        }

        stage('Run Tests') {
            steps {
                sh 'npm test'

                post {
                    failure {
                        emailext(
                            subject: "Test Failed: ${currentBuild.fullDisplayName}",
                            body: "Test failed for ${currentBuild.fullDisplayName}. Please investigate.",
                            to: 'a.ibrahimrajab@gmail.com',
                            replyTo: 'a.ibrahimrajab@gmail.com',
                            mimeType: 'text/plain',
                            recipientProviders: [[$class: 'CulpritsRecipientProvider']]
                        )
                    }
                }
            }
        }


    }


}
